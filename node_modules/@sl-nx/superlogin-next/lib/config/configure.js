'use strict';
Object.defineProperty(exports, "__esModule", { value: true });
exports.ConfigHelper = void 0;
const util_1 = require("../util");
const default_config_1 = require("./default.config");
class ConfigHelper {
    constructor(data = {}) {
        this.config = default_config_1.defaultConfig;
        // Some extra default settings if no config object is specified
        if (Object.keys(data).length === 0) {
            this.config.testMode = {
                noEmail: true,
                debugEmail: true
            };
        }
        else {
            this.config = (0, util_1.mergeConfig)(this.config, data);
            this.verifyConfig();
        }
    }
    /** Verifies the config against some incompatible settings */
    verifyConfig() {
        var _a, _b;
        if (((_a = this.config.local) === null || _a === void 0 ? void 0 : _a.requireEmailConfirm) &&
            !this.config.local.sendConfirmEmail) {
            throw 'sendConfirmEmail must also be set if requireEmailConfirm is.';
        }
        if ((_b = this.config.security) === null || _b === void 0 ? void 0 : _b.iterations) {
            const itArr = this.config.security.iterations;
            let prev = 0;
            for (const pair of itArr) {
                if (pair.length !== 2 ||
                    typeof pair[0] !== 'number' ||
                    typeof pair[1] !== 'number' ||
                    pair[0] < prev) {
                    throw 'iterations are specified but have invalid format!';
                }
                prev = pair[0];
            }
        }
    }
}
exports.ConfigHelper = ConfigHelper;
